let level = 5;
let score = 0;
let bestScore = 0;
let originalNumber = "";
let startTime = null;
let totalTries = 0;

async function startGame() {
  document.getElementById("startButton").style.display = "none";
  totalTries++;
  originalNumber = generateUniqueNumber(level);
  for (let digit of originalNumber) {
    displayDigit(digit);
    await sleep(1000);
    clearDisplay();
  }
  displayInputBoxes(level);
  startTime = new Date().getTime();
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function generateUniqueNumber(length) {
  const digits = [...Array(10).keys()];
  let number = "";
  for (let i = 0; i < length; i++) {
    const randIndex = Math.floor(Math.random() * digits.length);
    number += digits.splice(randIndex, 1);
  }
  return number;
}

function displayDigit(digit) {
  document.getElementById("numberDisplay").innerText = digit;
}

function clearDisplay() {
  document.getElementById("numberDisplay").innerText = "";
}

// Modified displayInputBoxes function
function displayInputBoxes(length) {
  const container = document.getElementById("userInputContainer");
  let previousInput = null;

  for (let i = 0; i < length; i++) {
    const input = document.createElement("input");
    input.type = "text";
    input.className = "input-box";
    input.maxLength = 1;
    input.disabled = true; // Disable the input by default

    // Enable the next input box when a digit is entered
    input.addEventListener('input', function() {
      if (this.nextSibling) {
        this.nextSibling.disabled = false;
        this.nextSibling.focus();
      }
    });

    container.appendChild(input);

    if (previousInput === null) {
      input.disabled = false; // Enable the first input box
    }

    previousInput = input;
  }

  document.getElementById("submitButton").style.display = "block";
  document.getElementById("userInputContainer").style.display = "block";
}
    
function checkAnswer() {
  let elapsedTime = new Date().getTime() - startTime;
  let userNumber = "";

  // Collect the user input
  document.querySelectorAll(".input-box").forEach(input => {
    userNumber += input.value;
  });

  // Reverse the userNumber
  userNumber = userNumber.split('').reverse().join('');

  // Print userNumber and originalNumber to console for debugging
  console.log("User Number: ", userNumber);
  console.log("Original Number: ", originalNumber);

  // Update level
  if (userNumber === originalNumber) {
    console.log("Correct! Leveling up.");
    level++;  // Increase the level indefinitely if the sequence is correct
  } else if (level > 2) {  // Decrease the level if the sequence is incorrect and level is greater than 2
    console.log("Incorrect! Leveling down.");
    level--;
  }

  // Partial credit based on correctness and timing
  let partialScore = 0;
  for (let i = 0; i < originalNumber.length; i++) {
    if (userNumber[i] === originalNumber[i]) {
      partialScore += 5;
    } else if (originalNumber.includes(userNumber[i])) {
      partialScore += 2;
    }
  }
  score += (partialScore * level) / totalTries - Math.floor(elapsedTime / 1000);

  // Update best score
  if (score > bestScore) {
    bestScore = score;
  }

  // Update UI
  document.getElementById("level").innerText = level;
  document.getElementById("score").innerText = Math.floor(score);
  document.getElementById("bestScore").innerText = Math.floor(bestScore);

  // Reset input boxes and buttons
  document.getElementById("userInputContainer").innerHTML = "";
  document.getElementById("submitButton").style.display = "none";
  document.getElementById("startButton").style.display = "block";
  
  // Restart the game
  startGame();
}


  </script>
  
</body>
</html>
